// Контракт для моделей, поддерживающих экспорт/импорт.

/// Миксин, определяющий контракт авто-расширяемого экспорта.
///
/// Каждая модель, реализующая [Exportable], объявляет:
/// - [internalDbFields] — поля из [toDb], которые НЕ экспортируются
/// - [dbToExportKeyMapping] — переименования ключей (db → export)
///
/// "Умный" тест сравнивает ключи [toDb] и [toExport] через маппинг
/// и автоматически ломается, если добавлено поле в БД, но не в экспорт.
mixin Exportable {
  /// Поля из [toDb], которые НЕ включаются в экспорт.
  ///
  /// Типичные internal поля: 'id', 'collection_id', 'added_at'.
  /// При добавлении нового поля в [toDb], оно автоматически
  /// обнаруживается тестом — разработчик должен либо добавить его
  /// сюда, либо обработать в [toExport].
  Set<String> get internalDbFields;

  /// Маппинг db_key → export_key для переименований.
  ///
  /// Используется, когда имя поля в экспорте отличается от имени в БД.
  /// Пример: `{'author_comment': 'comment'}`.
  /// Поля, не указанные здесь, экспортируются под оригинальным именем.
  Map<String, String> get dbToExportKeyMapping => const <String, String>{};

  /// Преобразует в Map для сохранения в базу данных.
  Map<String, dynamic> toDb();

  /// Преобразует в Map для экспорта.
  ///
  /// Реализация может отличаться от [toDb] по трансформациям
  /// (формат дат, кодировка данных, значения enum-ов).
  /// Тест-сторож проверяет, что набор ключей покрывает [toDb].
  Map<String, dynamic> toExport();
}
