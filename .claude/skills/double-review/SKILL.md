---
name: double-review
description: Двухэтапное ревью кода с улучшениями и оптимизациями. Используй перед завершением любой задачи.
---

# Двойное ревью кода

## Круг 1: Функциональность и корректность

### Чеклист:

#### Логика
- [ ] Код делает то, что требуется?
- [ ] Все edge cases обработаны?
- [ ] Нет логических ошибок?
- [ ] Алгоритм корректен?

#### Типизация
- [ ] Нет `dynamic`?
- [ ] Нет неявных типов в публичном API?
- [ ] Nullable типы обработаны правильно?
- [ ] Используется `final`/`const` где возможно?

#### Обработка ошибок
- [ ] Все исключения перехвачены?
- [ ] Ошибки логируются с контекстом?
- [ ] Пользователь получает понятные сообщения?
- [ ] Нет silent failures?

#### Безопасность
- [ ] Нет SQL/XSS инъекций?
- [ ] Данные валидируются на входе?
- [ ] Чувствительные данные не логируются?
- [ ] Нет хардкода секретов?

### Действия после Круга 1:
1. Исправить все найденные проблемы
2. Убедиться что тесты проходят
3. Перейти к Кругу 2

---

## Круг 2: Качество и производительность

### Чеклист:

#### Читаемость
- [ ] Имена переменных понятные и описательные?
- [ ] Функции не слишком длинные (< 30 строк)?
- [ ] Классы имеют одну ответственность?
- [ ] Код самодокументируемый?
- [ ] Сложная логика прокомментирована?

#### Дублирование
- [ ] Нет copy-paste кода?
- [ ] Общая логика вынесена в утилиты?
- [ ] Нет повторяющихся магических значений?

#### Производительность
- [ ] Нет O(n²) где можно O(n)?
- [ ] Нет лишних пересозданий объектов?
- [ ] Тяжёлые вычисления кэшируются?
- [ ] Нет утечек памяти (подписки, контроллеры)?

#### Flutter специфика
- [ ] Widgets используют `const` конструкторы?
- [ ] Нет лишних rebuild?
- [ ] Списки используют `ListView.builder`?
- [ ] `dispose()` вызывается для контроллеров?

#### Стиль кода
- [ ] Соответствует Dart style guide?
- [ ] `flutter analyze` без warnings?
- [ ] Импорты организованы (dart, package, relative)?

### Действия после Круга 2:
1. Применить все оптимизации
2. Убедиться что тесты всё ещё проходят
3. Запустить `flutter analyze`
4. Задача готова к коммиту

---

## Формат отчёта

После каждого круга предоставь отчёт:

```
## Ревью Круг [1/2]

### Найденные проблемы:
1. [Критично] Описание проблемы
   - Файл: path/to/file.dart:123
   - Исправление: ...

2. [Важно] Описание проблемы
   - Файл: path/to/file.dart:45
   - Исправление: ...

3. [Рекомендация] Описание улучшения
   - Файл: path/to/file.dart:78
   - Предложение: ...

### Исправлено в этом круге:
- Исправление 1
- Исправление 2

### Статус: [Переход к Кругу 2 / Готово к коммиту]
```
